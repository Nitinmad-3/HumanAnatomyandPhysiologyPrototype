<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Human Anatomy & Physiology</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .hidden { display: none; }
    .nav-btn { padding: 0.6em 1.2em; background: #1565c0; color: #fff; border-radius: 5px; text-decoration: none; margin-left: 1em;}
  </style>
</head>
<body>
  <header>
    <h1>Human Anatomy & Physiology</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="experiments.html">Experiments</a>
      <a href="assessments.html">Assessments</a>
      <a href="references.html">References</a>
      <a href="profile.html" id="profileTab" class="hidden">Profile</a>
      <a href="#" id="loginTab" class="nav-btn">Login</a>
      <a href="#" id="logoutTab" class="nav-btn hidden">Logout</a>
    </nav>
  </header>
  <!-- Login Modal -->
  <div id="loginModal" class="hidden" style="position:fixed;top:10%;left:0;width:100%;height:100%;background:rgba(0,0,0,0.15);z-index:100;">
    <div style="background:#fff;max-width:400px;margin:5rem auto;padding:2rem;border-radius:16px;box-shadow:0 2px 12px #90caf9;">
      <h2>Login</h2>
      <form id="loginForm">
        <label for="loginEmail">Login ID (Email or PRN)</label>
        <input type="text" id="loginEmail" name="loginEmail" required>
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" name="loginPassword" required>
        <button type="submit" class="nav-btn" style="width:100%;">Login</button>
        <div id="loginError" style="color:#d32f2f;margin-top:1em;"></div>
      </form>
      <button onclick="closeLoginModal()" style="margin-top:1em;">Cancel</button>
    </div>
  </div>
  <main>
    <!-- Page content -->
  </main>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
  <script>
    // --- Firebase config: fill in your own ---
    const firebaseConfig = { /* YOUR CONFIG */ };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // --- Navigation logic ---
    function show(id) { document.getElementById(id).classList.remove('hidden'); }
    function hide(id) { document.getElementById(id).classList.add('hidden'); }

    function openLoginModal() { show('loginModal'); }
    function closeLoginModal() { hide('loginModal'); }

    document.getElementById('loginTab').onclick = function(e) {
      e.preventDefault();
      openLoginModal();
    };

    document.getElementById('logoutTab').onclick = function(e) {
      e.preventDefault();
      auth.signOut();
      hide('profileTab');
      show('loginTab');
      hide('logoutTab');
    };

    // --- Login logic ---
    document.getElementById('loginForm').onsubmit = function(e) {
      e.preventDefault();
      const emailOrPrn = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      document.getElementById('loginError').textContent = "";

      // You should use email for Firebase Auth. If PRN is used, map to email first.
      // For demo, treating as email:
      auth.signInWithEmailAndPassword(emailOrPrn, password)
        .then(userCredential => {
          closeLoginModal();
          show('profileTab');
          hide('loginTab');
          show('logoutTab');
          window.location.href = "index.html"; // Redirect to homepage
        })
        .catch(error => {
          document.getElementById('loginError').textContent = "Login failed: " + error.message;
        });
    };

    // --- Session logic ---
    auth.onAuthStateChanged(async function(user) {
      if (user) {
        show('profileTab');
        hide('loginTab');
        show('logoutTab');
        // Check if profile is complete
        const doc = await db.collection('profiles').doc(user.uid).get();
        if (!doc.exists || !doc.data().name || !doc.data().role) {
          window.location.href = "profile.html"; // Force profile completion
        }
      } else {
        hide('profileTab');
        show('loginTab');
        hide('logoutTab');
      }
    });
  </script>
</body>
</html>
